---
import Layout from '../layouts/Layout.astro';
const base = import.meta.env.BASE_URL || '/';
const pfCss = base + 'pagefind/pagefind-ui.css';
const pfCssFallback = base + '_pagefind/pagefind-ui.css';
---

<Layout title="Search" description="Search the site">
	<Fragment slot="head">
	<!-- Load Pagefind UI CSS from the built site. Pagefind may output to `pagefind/` or `_pagefind/` -->
	<link rel="stylesheet" href={pfCss} onerror={`this.href='${pfCssFallback}'`} />
  </Fragment>

  <article class="search-page">
	<div class="search-page__inner">
		<label for="pf-search" class="sr-only">Search the site</label>
		<div id="search" aria-labelledby="pf-search" data-base={base}></div>
	</div>

    <script type="module">
      (async () => {
        const container = document.getElementById('search');
        const base = (container && container.dataset && container.dataset.base) || '/';
        try {
          const mod = await import(base + 'pagefind/pagefind-ui.js');
          const PagefindUI = mod?.PagefindUI ?? mod?.default ?? window?.PagefindUI;
          if (!PagefindUI) throw new Error('Pagefind UI not found in module');
          const params = new URLSearchParams(location.search);
          const q = params.get('q') || undefined;
          new PagefindUI({ element: '#search', showSubResults: true, showImages: false, showEmptyFilters: false, defaultTerm: q });
        } catch (e) {
          const mod = await import(base + '_pagefind/pagefind-ui.js');
          const PagefindUI = mod?.PagefindUI ?? mod?.default ?? window?.PagefindUI;
          if (!PagefindUI) throw new Error('Pagefind UI not found in fallback module');
          const params = new URLSearchParams(location.search);
          const q = params.get('q') || undefined;
          new PagefindUI({ element: '#search', showSubResults: true, showImages: false, showEmptyFilters: false, defaultTerm: q });
        }
      })();
    </script>
  </article>
</Layout>

<style>
	.search-page {
		padding: 0;
		background: transparent;
		box-shadow: none;
		border-radius: 0;
	}

	.search-page__inner {
		display: flex;
		flex-direction: column;
		gap: 32px;
		max-width: 800px;
		margin: 0 auto;
		padding: 24px 0 48px;
	}

	.search-page :global(.pagefind-ui) {
		display: flex;
		flex-direction: column;
		gap: 28px;
	}

	.search-page :global(.pagefind-ui__form) {
		display: flex;
		align-items: center;
		gap: 12px;
		padding: 14px 18px;
		border-radius: 12px;
		border: 1px solid rgba(226,232,240,0.8);
		background: rgba(255,255,255,0.95);
		box-shadow: 0 4px 12px rgba(15,23,42,0.08);
		transition: all 0.2s ease;
	}

	.search-page :global(.pagefind-ui__form:focus-within) {
		border-color: rgba(99,102,241,0.5);
		box-shadow: 0 0 0 3px rgba(99,102,241,0.1), 0 8px 20px rgba(15,23,42,0.12);
	}

	.search-page :global(.pagefind-ui__search-input) {
		flex: 1;
		font-size: 1rem;
		padding: 8px;
		background: transparent;
		color: #1e293b;
		border: none;
		outline: none;
	}

	.search-page :global(.pagefind-ui__search-input::placeholder) {
		color: rgba(100,116,139,0.7);
	}

	.search-page :global(.pagefind-ui__button) {
		min-width: 80px;
		border-radius: 8px;
		border: none;
		padding: 10px 16px;
		font-weight: 600;
		font-size: 0.9rem;
		background: linear-gradient(135deg, #6366f1, #8b5cf6);
		color: white;
		box-shadow: 0 4px 12px rgba(99,102,241,0.3);
		cursor: pointer;
		transition: all 0.2s ease;
	}

	.search-page :global(.pagefind-ui__button:hover) {
		transform: translateY(-1px);
		box-shadow: 0 6px 16px rgba(99,102,241,0.4);
	}

	.search-page :global(.pagefind-ui__results) {
		display: grid;
		gap: 18px;
	}

	.search-page :global(.pagefind-ui__result) {
		padding: 20px;
		border-radius: 12px;
		border: 1px solid rgba(226,232,240,0.6);
		background: rgba(255,255,255,0.9);
		box-shadow: 0 2px 8px rgba(15,23,42,0.06);
		transition: all 0.2s ease;
	}

	.search-page :global(.pagefind-ui__result:hover),
	.search-page :global(.pagefind-ui__result:focus-within) {
		transform: translateY(-2px);
		box-shadow: 0 8px 25px rgba(15,23,42,0.1);
		border-color: rgba(99,102,241,0.3);
	}

	.search-page :global(.pagefind-ui__result-title) {
		font-size: 1.1rem;
		font-weight: 600;
		color: #1e293b;
		margin-bottom: 8px;
	}

	.search-page :global(.pagefind-ui__result-excerpt) {
		font-size: 0.95rem;
		line-height: 1.6;
		color: #475569;
	}

	.search-page :global(.pagefind-ui__filter-scope) {
		border-radius: 6px;
		border: 1px solid rgba(226,232,240,0.8);
		background: rgba(248,250,252,0.9);
		color: #4b5563;
		padding: 4px 8px;
		font-size: 0.75rem;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		font-weight: 600;
	}

	.search-page :global(mark) {
		background: rgba(99,102,241,0.2);
		color: #1e293b;
		padding: 1px 3px;
		border-radius: 3px;
		font-weight: 600;
	}

	@media (max-width: 640px) {
		.search-page__inner {
			padding: 16px 16px 36px;
			gap: 24px;
		}
		.search-page :global(.pagefind-ui__form) {
			flex-direction: column;
			align-items: stretch;
			padding: 16px;
			border-radius: 12px;
		}
		.search-page :global(.pagefind-ui__button) {
			width: 100%;
		}
		.search-page :global(.pagefind-ui__result) {
			padding: 16px;
		}
	}
</style>
